---
layout: post
title: New index not improving performance with 389DS
categories:
- Administration
tags:
- LDAP
- Performance
- 389DS
comments: []
---
<p>If you are wondering why the brand new index you've just created on your 389DS / RedHat DirectoryServer does not improve performance then read on!<!--more--></p>
<p>This post assume you have already checked that the index actually exists.&nbsp; It can be done by checking if there is <code>db4</code> file with the name of the indexed attribute under the <code>$instanceName/db/$dbName/</code> folder.</p>
<p>With the default settings, the DS will stop using the index if more than 4000 entries belong to it. In this case, it will fall back to an "unindexed search" mode, and will read all the entries from the database.</p>
<p>From "<a href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Directory_Server/9.0/html/Administration_Guide/Managing_Indexes.html#About_Indexes-Overview_of_the_Searching_Algorithm" target="_blank">&sect;9.1.3 - Overview of the Searching Algorithm</a>":</p>
<blockquote><p>The Directory Server examines the search filter to see what indexes apply, and it attempts to load the list of entry IDs from each index that satisfies the filter. The ID lists are combined based on whether the filter used AND or OR joins.<br />
If the list of entry IDs is larger than the configured ID list scan limit or if there is no index, then the Directory Server searches every entry in the database. This is an unindexed search.</p></blockquote>
<p>The server-level parameter for "ID list scan limit" is called <code>nsslapd-idlistscanlimit</code>. You'll find it under <code>cn=config,cn=ldbm database,cn=plugins,cn=config</code>. Its default value is 4000. <a href="https://access.redhat.com/site/documentation//en-US/Red_Hat_Directory_Server/9.0/html/Configuration_Command_and_File_Reference/Database_Plug_in_Attributes.html#Database_Attributes_under_cnconfig_cnldbm_database_cnplugins_cnconfig" target="_blank">Source</a> (browse to "&sect;4.4.1.21. nsslapd-idlistscanlimit").</p>
<p>You can also set on a per-user basis with <code>nsIDListScanLimit</code>.</p>
<p>Though the doc states that "it is advisable to keep the default value", tweaking it can bring important and desirable performance improvements. Real life example achieved this morning: searching a 55000 entries OU from a 180MiB database:</p>
<ul>
<li>With&nbsp;nsslapd-idlistscanlimit=4000: 721 entries returned in 14241ms.</li>
<li>With nsslapd-idlistscanlimit=10000: 721 entries returned in 118ms.</li>
</ul>
<p>=> Performance gain: <strong>99,17%</strong> (!!)</p>
<p>That's why I allow myself changing this setting. But in order to prevent any side-effect, I only set it on a per-user basis.</p>
